(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5567:function(e,t,n){Promise.resolve().then(n.bind(n,4051))},4051:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(7437),a=n(2265),s=n(4279),i=n.n(s),l=n(7030),o=function(e,t,n){let r=function(e,t,n){let r=[],a=new Date(e);for(let e in n){let s=n[e],l=function(e){let t=e.split(","),n=[];for(let e in t)if(t[e].includes("-")){let r=t[e].split("-");for(let e=parseInt(r[0]);e<=parseInt(r[1]);e++)n.push(e)}else n.push(parseInt(t[e]));return n}(s.weeks),o=parseInt(s.weekday),d=t[s.time_choice];for(let e in l){let t=l[e],n=new Date(a);n.setDate(n.getDate()+(t-1)*7+(o-1));let g=n.getFullYear()+"-"+(n.getMonth()+1).toString().padStart(2,0)+"-"+n.getDate().toString().padStart(2,0)+" ",c=i().tz(g+d.start,"Asia/Shanghai").utc().format("YYYY-M-D-H-m").split("-").map(e=>parseInt(e)),m=i().tz(g+d.end,"Asia/Shanghai").utc().format("YYYY-M-D-H-m").split("-").map(e=>parseInt(e)),u={title:s.name,start:c,end:m,teacher:s.teacher,location:s.location,remarks:s.remarks};r.push(u)}}return r}(e,t,n),a=[];a.push({action:"audio",description:"Reminder",trigger:{minutes:20,before:!0},repeat:2,attachType:"VALUE=URI",attach:"Glass"});let s=[];for(let e in r){let t=r[e],n=t.title+" "+t.teacher+" "+t.location+" "+t.remarks,i={startInputType:"utc",endInputType:"utc",start:t.start,end:t.end,title:t.title,description:n,alarms:a};s.push(i)}let{error:o,value:d}=l.nj(s);return d};function d(){let[e,t]=(0,a.useState)([{name:"",start:"",end:""}]),n=(n,r)=>{let a=[...e];a[n][r.target.name]=r.target.value,t(a)},s=n=>{let r=[...e];r.splice(n,1),t(r)},[i,l]=(0,a.useState)([{name:"",weeks:"",weekday:"",time_choice:"",teacher:"",location:"",remarks:""}]),d=(e,t)=>{let n=[...i];n[e][t.target.name]=t.target.value,l(n)},g=e=>{let t=[...i];t.splice(e,1),l(t)},c=(0,a.useRef)(null),m=(0,a.useRef)(null);function u(){console.log("preview");let t=m.current.value,n={};for(let t in e)e[t].name.length>0&&(n[e[t].name]={start:e[t].start,end:e[t].end});c.current.value=o(t,n,i)}return(0,r.jsxs)("main",{className:"flex flex-col items-center justify-between p-24",children:[(0,r.jsxs)("div",{className:"w-2/3",children:[(0,r.jsx)("label",{htmlFor:"start_date",className:"block text-lg font-medium leading-6 text-gray-900",children:"开始日期"}),(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)("input",{id:"start_date",name:"start_date",ref:m,className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]}),(0,r.jsxs)("div",{className:"w-2/3",children:[(0,r.jsx)("label",{htmlFor:"time_table",className:"block text-lg font-medium leading-6 text-gray-900",children:"时间表"}),e.map((e,t)=>(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",name:"name",placeholder:"时间段名",value:e.name,onChange:e=>n(t,e)}),(0,r.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",name:"start",placeholder:"时间段起始时间",value:e.start,onChange:e=>n(t,e)}),(0,r.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",name:"end",placeholder:"时间段结束时间",value:e.end,onChange:e=>n(t,e)}),(0,r.jsx)("button",{className:"rounded-md bg-red-700 px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-red-400",onClick:()=>s(t),children:"删除"})]},t)),(0,r.jsx)("button",{className:"rounded-md bg-blue-500 px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-blue-400",onClick:()=>{t([...e,{name:"",start:"",end:""}])},children:"添加"})]}),(0,r.jsxs)("div",{className:"w-2/3",children:[(0,r.jsx)("label",{htmlFor:"cal_data",className:"block text-lg font-medium leading-6 text-gray-900",children:"课程表"}),i.map((e,t)=>(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",name:"name",placeholder:"课程名",value:e.name,onChange:e=>d(t,e)}),(0,r.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",name:"weeks",placeholder:"周次",value:e.weeks,onChange:e=>d(t,e)}),(0,r.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",name:"weekday",placeholder:"星期几",value:e.weekday,onChange:e=>d(t,e)}),(0,r.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",name:"time_choice",placeholder:"时间段",value:e.time_choice,onChange:e=>d(t,e)}),(0,r.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",name:"teacher",placeholder:"任课老师",value:e.teacher,onChange:e=>d(t,e)}),(0,r.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",name:"location",placeholder:"地点",value:e.location,onChange:e=>d(t,e)}),(0,r.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",name:"remarks",placeholder:"备注",value:e.remarks,onChange:e=>d(t,e)}),(0,r.jsx)("button",{className:"rounded-md bg-red-700 px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-red-400",onClick:()=>g(t),children:"删除"})]},t)),(0,r.jsx)("button",{className:"rounded-md bg-blue-500 px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-blue-400",onClick:()=>{l([...i,{name:"",weeks:"",weekday:"",time_choice:"",teacher:"",location:"",remarks:""}])},children:"添加"})]}),(0,r.jsx)("button",{type:"button",onClick:u,className:"rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:"预览"}),(0,r.jsxs)("div",{className:"w-2/3",children:[(0,r.jsx)("label",{htmlFor:"ics_data",className:"block text-sm font-medium leading-6 text-gray-900",children:"ICS 预览"}),(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)("textarea",{id:"ics_data",name:"ics_data",rows:"3",ref:c,className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]}),(0,r.jsx)("button",{type:"button",onClick:function(){u();let e=new Blob([c.current.value],{type:"text/plain"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="calendar.ics",document.body.appendChild(n),n.click(),URL.revokeObjectURL(t),document.body.removeChild(n)},className:"rounded-md bg-white px-2.5 py-1.5 text-sm mt-2 font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:"下载"})]})}}},function(e){e.O(0,[326,990,311,971,472,744],function(){return e(e.s=5567)}),_N_E=e.O()}]);